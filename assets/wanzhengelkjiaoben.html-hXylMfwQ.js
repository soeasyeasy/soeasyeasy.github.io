import{_ as n,c as a,a as e,o as t}from"./app-qwDAWgIM.js";const l={};function p(i,s){return t(),a("div",null,s[0]||(s[0]=[e(`<p>å¤ªå¥½äº†ï¼æ‚¨å¸Œæœ›ä½¿ç”¨ <strong>Docker</strong> æ¥å¯åŠ¨ <strong>Logstash</strong>ï¼Œå¹¶å°†åº”ç”¨çš„æ§åˆ¶å°æ—¥å¿—ï¼ˆå¦‚ Spring Bootã€Node.js ç­‰ï¼‰é€šè¿‡ Logstash æ”¶é›†å¹¶å†™å…¥ Elasticsearchã€‚</p><p>ä¸‹é¢æˆ‘ä¸ºæ‚¨æä¾›ä¸€ä¸ª <strong>å®Œæ•´ã€å¯è¿è¡Œçš„ Docker + Logstash + Elasticsearch + Kibana</strong> é›†æˆæ–¹æ¡ˆï¼Œé€‚ç”¨äºç”Ÿäº§æˆ–å¼€å‘ç¯å¢ƒã€‚</p><hr><h2 id="âœ…-ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#âœ…-ç›®æ ‡"><span>âœ… ç›®æ ‡</span></a></h2><p>å°†åº”ç”¨çš„ <strong>æ§åˆ¶å°æ—¥å¿—</strong> â†’ <strong>Logstashï¼ˆDockerï¼‰</strong> â†’ <strong>Elasticsearchï¼ˆDockerï¼‰</strong> â†’ <strong>Kibana å¯è§†åŒ–</strong></p><hr><h2 id="âœ…-æ•´ä½“æ¶æ„" tabindex="-1"><a class="header-anchor" href="#âœ…-æ•´ä½“æ¶æ„"><span>âœ… æ•´ä½“æ¶æ„</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">[Your App]</span>
<span class="line">     â†“ (stdout)</span>
<span class="line">[Docker Container Log]</span>
<span class="line">     â†“</span>
<span class="line">[Filebeat æˆ–ç›´æ¥ TCP/HTTP]</span>
<span class="line">     â†“</span>
<span class="line">[Logstash (Docker)] â†’ è§£æã€è¿‡æ»¤</span>
<span class="line">     â†“</span>
<span class="line">[Elasticsearch (Docker)] â†’ å­˜å‚¨</span>
<span class="line">     â†“</span>
<span class="line">[Kibana (Docker)] â†’ å¯è§†åŒ–</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="âœ…-æ­¥éª¤-1-å‡†å¤‡-docker-compose-yml" tabindex="-1"><a class="header-anchor" href="#âœ…-æ­¥éª¤-1-å‡†å¤‡-docker-compose-yml"><span>âœ… æ­¥éª¤ 1ï¼šå‡†å¤‡ <code>docker-compose.yml</code></span></a></h2><p>åˆ›å»ºä¸€ä¸ª <code>docker-compose.yml</code> æ–‡ä»¶ï¼Œç»Ÿä¸€ç®¡ç†æ‰€æœ‰æœåŠ¡ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.8&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/elasticsearch/elasticsearch<span class="token punctuation">:</span>7.17.18</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> elasticsearch</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> discovery.type=single<span class="token punctuation">-</span>node</span>
<span class="line">      <span class="token punctuation">-</span> xpack.security.enabled=false</span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;ES_JAVA_OPTS=-Xms1g -Xmx1g&quot;</span></span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;9200:9200&quot;</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;9300:9300&quot;</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> esdata<span class="token punctuation">:</span>/usr/share/elasticsearch/data</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> elk</span>
<span class="line"></span>
<span class="line">  <span class="token key atrule">kibana</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/kibana/kibana<span class="token punctuation">:</span>7.17.18</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kibana</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> elasticsearch</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ELASTICSEARCH_HOSTS=http<span class="token punctuation">:</span>//elasticsearch<span class="token punctuation">:</span><span class="token number">9200</span></span>
<span class="line">      <span class="token punctuation">-</span> xpack.security.enabled=false</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;5601:5601&quot;</span></span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> elk</span>
<span class="line"></span>
<span class="line">  <span class="token key atrule">logstash</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/logstash/logstash<span class="token punctuation">:</span>7.17.18</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> logstash</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> elasticsearch</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;5000:5000/tcp&quot;</span> <span class="token comment"># æ¥æ”¶ JSON æ—¥å¿—ï¼ˆå¦‚ Logback TCPï¼‰</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;5044:5044&quot;</span> <span class="token comment"># æ¥æ”¶ Filebeatï¼ˆæ¨èï¼‰</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./logstash.conf<span class="token punctuation">:</span>/usr/share/logstash/pipeline/logstash.conf</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> xpack.monitoring.enabled=false</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> elk</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">esdata</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">elk</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="âœ…-æ­¥éª¤-2-åˆ›å»º-logstash-conf" tabindex="-1"><a class="header-anchor" href="#âœ…-æ­¥éª¤-2-åˆ›å»º-logstash-conf"><span>âœ… æ­¥éª¤ 2ï¼šåˆ›å»º <code>logstash.conf</code></span></a></h2><p>åœ¨ <code>docker-compose.yml</code> åŒçº§ç›®å½•åˆ›å»º <code>logstash.conf</code>ï¼š</p><div class="language-conf line-numbers-mode" data-highlighter="prismjs" data-ext="conf" data-title="conf"><pre><code><span class="line"># è¾“å…¥ï¼šæ¥æ”¶æ¥è‡ªåº”ç”¨æˆ– Filebeat çš„æ—¥å¿—</span>
<span class="line">input {</span>
<span class="line">  # æ–¹å¼1ï¼šæ¥æ”¶ Filebeat å‘é€çš„æ—¥å¿—ï¼ˆæ¨èï¼‰</span>
<span class="line">  beats {</span>
<span class="line">    port =&gt; 5044</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  # æ–¹å¼2ï¼šæ¥æ”¶ TCP JSON æ—¥å¿—ï¼ˆå¦‚ Java åº”ç”¨ç›´æ¥å‘ï¼‰</span>
<span class="line">  # tcp {</span>
<span class="line">  #   port =&gt; 5000</span>
<span class="line">  #   codec =&gt; json</span>
<span class="line">  # }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"># è¿‡æ»¤ï¼šè§£æã€ä¸°å¯Œã€ä¿®æ”¹æ—¥å¿—</span>
<span class="line">filter {</span>
<span class="line">  # å¦‚æœæ˜¯ Java å¼‚å¸¸å †æ ˆï¼Œåˆå¹¶å¤šè¡Œ</span>
<span class="line">  if [message] =~ &quot;\\t&quot; {</span>
<span class="line">    multiline {</span>
<span class="line">      pattern =&gt; &quot;^\\t&quot;</span>
<span class="line">      what =&gt; &quot;previous&quot;</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  # ç¤ºä¾‹ï¼šæ·»åŠ è‡ªå®šä¹‰å­—æ®µ</span>
<span class="line">  mutate {</span>
<span class="line">    add_field =&gt; { &quot;app_name&quot; =&gt; &quot;my-java-app&quot; }</span>
<span class="line">    add_field =&gt; { &quot;env&quot; =&gt; &quot;production&quot; }</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  # å¯é€‰ï¼šä½¿ç”¨ Grok è§£æéç»“æ„åŒ–æ—¥å¿—</span>
<span class="line">  # grok {</span>
<span class="line">  #   match =&gt; { &quot;message&quot; =&gt; &quot;%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:level} %{JAVACLASS:class} - %{GREEDYDATA:log_message}&quot; }</span>
<span class="line">  # }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"># è¾“å‡ºï¼šå†™å…¥ Elasticsearch</span>
<span class="line">output {</span>
<span class="line">  elasticsearch {</span>
<span class="line">    hosts =&gt; &quot;http://elasticsearch:9200&quot;</span>
<span class="line">    index =&gt; &quot;app-logs-%{+YYYY.MM.dd}&quot;</span>
<span class="line">    # å¯é€‰ï¼šæŸ¥çœ‹å‘é€å†…å®¹ï¼ˆè°ƒè¯•ç”¨ï¼‰</span>
<span class="line">    # stdout { codec =&gt; rubydebug }</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="âœ…-æ­¥éª¤-3-å¯åŠ¨-elk-æ ˆ" tabindex="-1"><a class="header-anchor" href="#âœ…-æ­¥éª¤-3-å¯åŠ¨-elk-æ ˆ"><span>âœ… æ­¥éª¤ 3ï¼šå¯åŠ¨ ELK æ ˆ</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker-compose</span> logs <span class="token parameter variable">-f</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>çœ‹åˆ° <code>Kibana is now available</code> è¡¨ç¤ºå¯åŠ¨æˆåŠŸã€‚</p><hr><h2 id="âœ…-æ­¥éª¤-4-å‘é€æ—¥å¿—åˆ°-logstash" tabindex="-1"><a class="header-anchor" href="#âœ…-æ­¥éª¤-4-å‘é€æ—¥å¿—åˆ°-logstash"><span>âœ… æ­¥éª¤ 4ï¼šå‘é€æ—¥å¿—åˆ° Logstash</span></a></h2><h3 id="âœ…-æ–¹å¼-a-ä½¿ç”¨-filebeat-æ¨è" tabindex="-1"><a class="header-anchor" href="#âœ…-æ–¹å¼-a-ä½¿ç”¨-filebeat-æ¨è"><span>âœ… æ–¹å¼ Aï¼šä½¿ç”¨ Filebeatï¼ˆæ¨èï¼‰</span></a></h3><h4 id="_1-å®‰è£…-filebeat-åœ¨å®¿ä¸»æœºæˆ–å¦ä¸€ä¸ªå®¹å™¨" tabindex="-1"><a class="header-anchor" href="#_1-å®‰è£…-filebeat-åœ¨å®¿ä¸»æœºæˆ–å¦ä¸€ä¸ªå®¹å™¨"><span>1. å®‰è£… Filebeatï¼ˆåœ¨å®¿ä¸»æœºæˆ–å¦ä¸€ä¸ªå®¹å™¨ï¼‰</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token parameter variable">-O</span> https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.17.18-linux-x86_64.tar.gz</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xzf</span> filebeat-7.17.18-linux-x86_64.tar.gz</span>
<span class="line"><span class="token builtin class-name">cd</span> filebeat-7.17.18-linux-x86_64</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-é…ç½®-filebeat-yml" tabindex="-1"><a class="header-anchor" href="#_2-é…ç½®-filebeat-yml"><span>2. é…ç½® <code>filebeat.yml</code></span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">filebeat.inputs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> log</span>
<span class="line">    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">paths</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> /path/to/your/app.log <span class="token comment"># ä½ çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">output.logstash</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;localhost:5044&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-å¯åŠ¨-filebeat" tabindex="-1"><a class="header-anchor" href="#_3-å¯åŠ¨-filebeat"><span>3. å¯åŠ¨ Filebeat</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> ./filebeat <span class="token parameter variable">-e</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>âœ… æ—¥å¿—ä¼šé€šè¿‡ 5044 ç«¯å£å‘é€åˆ° Logstashã€‚</p></blockquote><hr><h3 id="âœ…-æ–¹å¼-b-java-åº”ç”¨ç›´æ¥å‘-tcp-ç»“æ„åŒ–-json" tabindex="-1"><a class="header-anchor" href="#âœ…-æ–¹å¼-b-java-åº”ç”¨ç›´æ¥å‘-tcp-ç»“æ„åŒ–-json"><span>âœ… æ–¹å¼ Bï¼šJava åº”ç”¨ç›´æ¥å‘ TCPï¼ˆç»“æ„åŒ– JSONï¼‰</span></a></h3><h4 id="_1-æ·»åŠ ä¾èµ–-spring-boot" tabindex="-1"><a class="header-anchor" href="#_1-æ·»åŠ ä¾èµ–-spring-boot"><span>1. æ·»åŠ ä¾èµ–ï¼ˆSpring Bootï¼‰</span></a></h4><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.logstash.logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>logstash-logback-encoder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-é…ç½®-logback-spring-xml" tabindex="-1"><a class="header-anchor" href="#_2-é…ç½®-logback-spring-xml"><span>2. é…ç½® <code>logback-spring.xml</code></span></a></h4><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LOGSTASH<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>net.logstash.logback.appender.LogstashTcpSocketAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>destination</span><span class="token punctuation">&gt;</span></span>localhost:5000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>destination</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>net.logstash.logback.encoder.LogstashEncoder<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INFO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LOGSTASH<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âœ… åº”ç”¨å¯åŠ¨åï¼Œæ—¥å¿—ä¼šä»¥ JSON æ ¼å¼å‘é€åˆ° <code>localhost:5000</code>ï¼Œè¢« Logstash æ¥æ”¶ã€‚</p></blockquote><hr><h2 id="âœ…-æ­¥éª¤-5-åœ¨-kibana-æŸ¥çœ‹æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#âœ…-æ­¥éª¤-5-åœ¨-kibana-æŸ¥çœ‹æ—¥å¿—"><span>âœ… æ­¥éª¤ 5ï¼šåœ¨ Kibana æŸ¥çœ‹æ—¥å¿—</span></a></h2><ol><li>æ‰“å¼€ï¼š<code>http://localhost:5601</code></li><li>è¿›å…¥ <strong>Stack Management &gt; Index Patterns</strong></li><li>åˆ›å»ºç´¢å¼•æ¨¡å¼ï¼š<code>app-logs-*</code></li><li>è¿›å…¥ <strong>Discover</strong>ï¼Œé€‰æ‹©è¯¥ç´¢å¼•æ¨¡å¼</li><li>âœ… æ‚¨å°†çœ‹åˆ°ç»“æ„åŒ–çš„æ—¥å¿—æ•°æ®ï¼</li></ol><hr><h2 id="âœ…-éªŒè¯-logstash-æ˜¯å¦æ”¶åˆ°æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#âœ…-éªŒè¯-logstash-æ˜¯å¦æ”¶åˆ°æ—¥å¿—"><span>âœ… éªŒè¯ Logstash æ˜¯å¦æ”¶åˆ°æ—¥å¿—</span></a></h2><p>æŸ¥çœ‹ Logstash æ—¥å¿—ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> logstash</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœçœ‹åˆ°ç±»ä¼¼ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Pipeline started successfully</span>
<span class="line">Received incoming event from beats</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯´æ˜æ—¥å¿—å·²æˆåŠŸæ¥æ”¶ã€‚</p><hr><h2 id="âœ…-å¸¸è§é—®é¢˜æ’æŸ¥" tabindex="-1"><a class="header-anchor" href="#âœ…-å¸¸è§é—®é¢˜æ’æŸ¥"><span>âœ… å¸¸è§é—®é¢˜æ’æŸ¥</span></a></h2><table><thead><tr><th>é—®é¢˜</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>Logstash å¯åŠ¨å¤±è´¥</td><td>æ£€æŸ¥ <code>logstash.conf</code> è¯­æ³•æ˜¯å¦æ­£ç¡®</td></tr><tr><td>æ— æ³•è¿æ¥ Elasticsearch</td><td>ç¡®ä¿ <code>hosts =&gt; &quot;http://elasticsearch:9200&quot;</code>ï¼Œä½¿ç”¨å®¹å™¨å</td></tr><tr><td>Filebeat å‘é€å¤±è´¥</td><td>æ£€æŸ¥ <code>output.logstash.hosts</code> æ˜¯å¦ä¸º <code>localhost:5044</code></td></tr><tr><td>æ—¥å¿—æœªæ˜¾ç¤º</td><td>æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨ï¼š<code>GET _cat/indices?v</code></td></tr></tbody></table><hr><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Unable to load plugin. {:type=&gt;&quot;filter&quot;, :name=&gt;&quot;multiline&quot;}</span>
<span class="line">2025-08-13 17:55:16 [2025-08-13T09:55:16,168][ERROR][logstash.agent           ] Failed to execute action {:action=&gt;LogStash::PipelineAction::Create/pipeline_id:main, :exception=&gt;&quot;Java::JavaLang::IllegalStateException&quot;, :message=&gt;&quot;Unable to configure plugins: (PluginLoadingError) Couldn&#39;t find any filter plugin named &#39;multiline&#39;. Are you sure this is correct? Trying to load the multiline filter plugin resulted in this error: Unable to load the requested plugin named multiline of type filter. The plugin is not installed.&quot;, :backtrace=&gt;[&quot;org.logstash.config.ir.CompiledPipeline.&lt;init&gt;(CompiledPipeline.java:120)&quot;, &quot;org.logstash.execution.JavaBasePipelineExt.initialize(JavaBasePipelineExt.java:86)&quot;, &quot;org.logstash.execution.JavaBasePipelineExt$INVOKER$i$1$0$initialize.call(JavaBasePipelineExt$INVOKER$i$1$0$initialize.gen)&quot;, &quot;org.jruby.internal.runtime.methods.JavaMethod$JavaMethodN.call(JavaMethod.java:837)&quot;, &quot;org.jruby.ir.runtime.IRRuntimeHelpers.instanceSuper(IRRuntimeHelpers.java:1169)&quot;, &quot;org.jruby.ir.runtime.IRRuntimeHelpers.instanceSuperSplatArgs(IRRuntimeHelpers.java:1156)&quot;, &quot;org.jruby.ir.targets.InstanceSuperInvokeSite.invoke(InstanceSuperInvokeSite.java:39)&quot;, &quot;usr.share.logstash.logstash_minus_core.lib.logstash.java_pipeline.RUBY$method$initialize$0(/usr/share/logstash/logstash-core/lib/logstash/java_pipeline.rb:48)&quot;, &quot;org.jruby.internal.runtime.methods.CompiledIRMethod.call(CompiledIRMethod.java:80)&quot;, &quot;org.jruby.internal.runtime.methods.MixedModeIRMethod.call(MixedModeIRMethod.java:70)&quot;, &quot;org.jruby.runtime.callsite.CachingCallSite.cacheAndCall(CachingCallSite.java:333)&quot;, &quot;org.jruby.runtime.callsite.CachingCallSite.call(CachingCallSite.java:87)&quot;, &quot;org.jruby.RubyClass.newInstance(RubyClass.java:939)&quot;, &quot;org.jruby.RubyClass$INVOKER$i$newInstance.call(RubyClass$INVOKER$i$newInstance.gen)&quot;, &quot;org.jruby.ir.targets.InvokeSite.invoke(InvokeSite.java:207)&quot;, &quot;usr.share.logstash.logstash_minus_core.lib.logstash.pipeline_action.create.RUBY$method$execute$0(/usr/share/logstash/logstash-core/lib/logstash/pipeline_action/create.rb:52)&quot;, &quot;usr.share.logstash.logstash_minus_core.lib.logstash.pipeline_action.create.RUBY$method$execute$0$__VARARGS__(/usr/share/logstash/logstash-core/lib/logstash/pipeline_action/create.rb:50)&quot;, &quot;org.jruby.internal.runtime.methods.CompiledIRMethod.call(CompiledIRMethod.java:80)&quot;, &quot;org.jruby.internal.runtime.methods.MixedModeIRMethod.call(MixedModeIRMethod.java:70)&quot;, &quot;org.jruby.ir.targets.InvokeSite.invoke(InvokeSite.java:207)&quot;, &quot;usr.share.logstash.logstash_minus_core.lib.logstash.agent.RUBY$block$converge_state$2(/usr/share/logstash/logstash-core/lib/logstash/agent.rb:392)&quot;, &quot;org.jruby.runtime.CompiledIRBlockBody.callDirect(CompiledIRBlockBody.java:138)&quot;, &quot;org.jruby.runtime.IRBlockBody.call(IRBlockBody.java:58)&quot;, &quot;org.jruby.runtime.IRBlockBody.call(IRBlockBody.java:52)&quot;, &quot;org.jruby.runtime.Block.call(Block.java:139)&quot;, &quot;org.jruby.RubyProc.call(RubyProc.java:318)&quot;, &quot;org.jruby.internal.runtime.RubyRunnable.run(RubyRunnable.java:105)&quot;, &quot;java.base/java.lang.Thread.run(Thread.java:829)&quot;]}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»é”™è¯¯ä¿¡æ¯æ¥çœ‹ï¼ŒLogstash åœ¨å°è¯•åŠ è½½ <code>multiline</code> è¿‡æ»¤å™¨æ’ä»¶æ—¶é‡åˆ°äº†é—®é¢˜ã€‚é”™è¯¯æç¤ºæŒ‡å‡ºæ‰¾ä¸åˆ°åä¸º <code>multiline</code> çš„è¿‡æ»¤å™¨æ’ä»¶ã€‚å®é™…ä¸Šï¼Œåœ¨ Logstash ä¸­ç”¨äºå¤„ç†å¤šè¡Œæ—¥å¿—çš„æ’ä»¶åç§°åº”è¯¥æ˜¯ <code>multiline</code> æ’ä»¶ï¼Œä½†å®ƒå®é™…ä¸Šæ˜¯ <code>logstash-filter-multiline</code> çš„ä¸€éƒ¨åˆ†ï¼Œä¸”åœ¨è¾ƒæ–°ç‰ˆæœ¬ä¸­å¯èƒ½éœ€è¦ç‰¹åˆ«å®‰è£…æˆ–è€…ä½¿ç”¨æ­£ç¡®çš„é…ç½®ã€‚</p><p>ä¸è¿‡ï¼Œæ ¹æ®æ‚¨çš„æƒ…å†µï¼Œä¼¼ä¹æ‚¨ä½¿ç”¨çš„å¯èƒ½æ˜¯æ—§ç‰ˆæœ¬çš„ Logstash æˆ–è€…ç¼ºå°‘äº†å¿…è¦çš„æ’ä»¶å®‰è£…æ­¥éª¤ã€‚è¿™é‡Œæä¾›ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ"><span>è§£å†³æ–¹æ¡ˆ</span></a></h3><h4 id="_1-ä½¿ç”¨æ­£ç¡®çš„æ’ä»¶åç§°" tabindex="-1"><a class="header-anchor" href="#_1-ä½¿ç”¨æ­£ç¡®çš„æ’ä»¶åç§°"><span>1. ä½¿ç”¨æ­£ç¡®çš„æ’ä»¶åç§°</span></a></h4><p>é¦–å…ˆç¡®è®¤æ˜¯å¦ç¡®å®éœ€è¦ <code>multiline</code> æ’ä»¶æ¥åˆå¹¶å¤šè¡Œæ—¥å¿—ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œè¯·ç¡®ä¿ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>ç¡®è®¤æ‚¨æ­£åœ¨ä½¿ç”¨çš„æ˜¯æ”¯æŒ <code>multiline</code> æ’ä»¶çš„ Logstash ç‰ˆæœ¬ã€‚</li><li>å¦‚æœæ˜¯ Docker éƒ¨ç½²ï¼Œç¡®ä¿ Docker é•œåƒåŒ…å«äº†æ‰€æœ‰å¿…è¦çš„æ’ä»¶ã€‚</li></ul><p>å¯¹äºæ‚¨çš„æƒ…å†µï¼Œå¯èƒ½æ›´æ¨èä½¿ç”¨ <code>aggregate</code> æˆ–è€… <code>json</code> è¿™æ ·çš„è¿‡æ»¤å™¨æ¥å¤„ç†æ—¥å¿—ï¼Œä½†é’ˆå¯¹å¤šè¡Œæ—¥å¿—ï¼ˆå¦‚ Java å¼‚å¸¸å †æ ˆï¼‰ï¼Œåº”è¯¥ä½¿ç”¨ <code>multiline</code> æ’ä»¶çš„æ­£ç¡®é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="language-conf line-numbers-mode" data-highlighter="prismjs" data-ext="conf" data-title="conf"><pre><code><span class="line">input {</span>
<span class="line">  # æ‚¨çš„è¾“å…¥é…ç½®</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">filter {</span>
<span class="line">  if [type] == &quot;your-log-type&quot; {</span>
<span class="line">    multiline {</span>
<span class="line">      pattern =&gt; &quot;^\\t&quot; # æ ¹æ®æ‚¨çš„æ—¥å¿—æ ¼å¼è°ƒæ•´æ­¤æ­£åˆ™è¡¨è¾¾å¼</span>
<span class="line">      what =&gt; &quot;previous&quot;</span>
<span class="line">      negate =&gt; true</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">output {</span>
<span class="line">  elasticsearch {</span>
<span class="line">    hosts =&gt; [&quot;http://elasticsearch:9200&quot;]</span>
<span class="line">    index =&gt; &quot;app-logs-%{+YYYY.MM.dd}&quot;</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼ŒåŸºäºæ‚¨çš„é”™è¯¯ä¿¡æ¯ï¼Œçœ‹èµ·æ¥ Logstash å¹¶æ²¡æœ‰æ‰¾åˆ° <code>multiline</code> æè¿°çš„æ’ä»¶ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºè¯¥æ’ä»¶æœªè¢«åŒ…å«åœ¨é»˜è®¤çš„ Logstash å®‰è£…åŒ…å†…ã€‚</p><h4 id="_2-å®‰è£…ç¼ºå¤±çš„æ’ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-å®‰è£…ç¼ºå¤±çš„æ’ä»¶"><span>2. å®‰è£…ç¼ºå¤±çš„æ’ä»¶</span></a></h4><p>å¦‚æœç¡®å®šæ˜¯ç¼ºå°‘æ’ä»¶çš„é—®é¢˜ï¼Œæ‚¨å¯ä»¥å°è¯•æ‰‹åŠ¨å®‰è£… <code>logstash-filter-multiline</code> æ’ä»¶ã€‚ç„¶è€Œï¼Œåœ¨ Docker ç¯å¢ƒä¸‹ç›´æ¥æ“ä½œ Logstash å®¹å™¨å†…çš„æ’ä»¶ä¸æ˜¯æœ€ä½³å®è·µã€‚ç›¸åï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Dockerfile æ¥é¢„å®‰è£…æ‰€éœ€çš„æ’ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Dockerfileï¼š</p><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker" data-title="docker"><pre><code><span class="line"><span class="token instruction"><span class="token keyword">FROM</span> docker.elastic.co/logstash/logstash:7.17.18</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> logstash-plugin install logstash-filter-multiline</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæ„å»ºå¹¶ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰é•œåƒï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> my-logstash <span class="token builtin class-name">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ›´æ–° <code>docker-compose.yml</code> æ–‡ä»¶ä»¥ä½¿ç”¨æ–°çš„é•œåƒï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">logstash</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>logstash</span>
<span class="line">    <span class="token comment"># å…¶ä½™é…ç½®...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-æ›¿ä»£æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_3-æ›¿ä»£æ–¹æ¡ˆ"><span>3. æ›¿ä»£æ–¹æ¡ˆ</span></a></h4><p>å¦‚æœæ‚¨åªæ˜¯éœ€è¦å¤„ç†å¤šè¡Œæ—¥å¿—ï¼Œå¦ä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨ Filebeat çš„å¤šè¡Œæ—¥å¿—æ”¶é›†åŠŸèƒ½ï¼Œè¿™æ ·å°±ä¸éœ€è¦åœ¨ Logstash ä¸­å¤„ç†å¤šè¡Œæ—¥å¿—äº†ã€‚Filebeat æ”¯æŒéå¸¸çµæ´»çš„å¤šè¡Œæ—¥å¿—åˆå¹¶ç­–ç•¥ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ Filebeat çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹éƒ¨åˆ†ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">filebeat.inputs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> log</span>
<span class="line">    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">paths</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> /path/to/your/logs/<span class="token important">*.log</span></span>
<span class="line">    <span class="token key atrule">multiline.pattern</span><span class="token punctuation">:</span> <span class="token string">&#39;^\\t&#39;</span> <span class="token comment"># æ ¹æ®æ‚¨çš„æ—¥å¿—æ ¼å¼è°ƒæ•´</span></span>
<span class="line">    <span class="token key atrule">multiline.negate</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">    <span class="token key atrule">multiline.match</span><span class="token punctuation">:</span> after</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹æ³•å‡å°‘äº† Logstash çš„è´Ÿæ‹…ï¼Œå¹¶ç®€åŒ–äº†æ•´ä¸ª ELK å †æ ˆçš„æ—¥å¿—å¤„ç†æµç¨‹ã€‚</p><hr><p>éå¸¸å¥½çš„é—®é¢˜ï¼</p><p>æ‚¨æåˆ°ç›®å‰æ˜¯ <strong>â€œä¸€è¡Œä¸€è¡Œâ€ å‘é€æ—¥å¿—åˆ° Logstash</strong>ï¼Œè§‰å¾—è¿™æ · <strong>ç½‘ç»œå¼€é”€å¤§ã€æ•ˆç‡ä½ã€æµªè´¹èµ„æº</strong> â€”â€” æ‚¨çš„ç›´è§‰å®Œå…¨æ­£ç¡®ã€‚</p><hr><h2 id="âœ…-ç›®æ ‡-å‹ç¼©æ—¥å¿—ä¼ è¾“" tabindex="-1"><a class="header-anchor" href="#âœ…-ç›®æ ‡-å‹ç¼©æ—¥å¿—ä¼ è¾“"><span>âœ… ç›®æ ‡ï¼šå‹ç¼©æ—¥å¿—ä¼ è¾“</span></a></h2><p>æˆ‘ä»¬è¦å®ç°ï¼š</p><blockquote><p><strong>å‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ã€é™ä½å»¶è¿Ÿã€èŠ‚çœå¸¦å®½ã€æå‡ååé‡</strong></p></blockquote><hr><h2 id="ğŸš€-æ¨èæ–¹æ¡ˆ-æŒ‰ä¼˜å…ˆçº§æ’åº" tabindex="-1"><a class="header-anchor" href="#ğŸš€-æ¨èæ–¹æ¡ˆ-æŒ‰ä¼˜å…ˆçº§æ’åº"><span>ğŸš€ æ¨èæ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰</span></a></h2><hr><h3 id="âœ…-æ–¹æ¡ˆ-1-ä½¿ç”¨-filebeat-bulk-æ‰¹é‡å‘é€-æœ€æ¨è-ç”Ÿäº§é¦–é€‰" tabindex="-1"><a class="header-anchor" href="#âœ…-æ–¹æ¡ˆ-1-ä½¿ç”¨-filebeat-bulk-æ‰¹é‡å‘é€-æœ€æ¨è-ç”Ÿäº§é¦–é€‰"><span>âœ… æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ <strong>Filebeat + Bulk æ‰¹é‡å‘é€</strong>ï¼ˆæœ€æ¨èï¼ç”Ÿäº§é¦–é€‰ï¼‰</span></a></h3><p><strong>Filebeat</strong> æ˜¯ Elastic å®˜æ–¹è½»é‡çº§é‡‡é›†å™¨ï¼Œå¤©ç”Ÿæ”¯æŒï¼š</p><ul><li>æ‰¹é‡å‘é€ï¼ˆBulk APIï¼‰</li><li>å‹ç¼©ï¼ˆgzipï¼‰</li><li>èƒŒå‹æ§åˆ¶</li><li>æ–­ç‚¹ç»­ä¼ </li><li>å¤šè¡Œæ—¥å¿—åˆå¹¶</li></ul><h4 id="é…ç½®-filebeat-yml-å¯ç”¨å‹ç¼©å’Œæ‰¹é‡" tabindex="-1"><a class="header-anchor" href="#é…ç½®-filebeat-yml-å¯ç”¨å‹ç¼©å’Œæ‰¹é‡"><span>é…ç½® <code>filebeat.yml</code> å¯ç”¨å‹ç¼©å’Œæ‰¹é‡ï¼š</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">filebeat.inputs</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> log</span>
<span class="line">  <span class="token key atrule">paths</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> /app/logs/<span class="token important">*.log</span></span>
<span class="line">  <span class="token key atrule">multiline.pattern</span><span class="token punctuation">:</span> <span class="token string">&#39;^\\[&#39;</span></span>
<span class="line">  <span class="token key atrule">multiline.negate</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">multiline.match</span><span class="token punctuation">:</span> after</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">output.logstash</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;logstash:5044&quot;</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token comment"># å¯ç”¨ gzip å‹ç¼©</span></span>
<span class="line">  <span class="token key atrule">compression_level</span><span class="token punctuation">:</span> <span class="token number">6</span>  <span class="token comment"># 0=ä¸å‹ç¼©, 6=ä¸­ç­‰, 9=æœ€é«˜</span></span>
<span class="line">  <span class="token comment"># æ‰¹é‡å‘é€</span></span>
<span class="line">  <span class="token key atrule">bulk_max_size</span><span class="token punctuation">:</span> <span class="token number">2048</span>   <span class="token comment"># æ¯æ‰¹æœ€å¤š 2048 æ¡</span></span>
<span class="line">  <span class="token comment"># å‘é€é—´éš”ï¼ˆå³ä½¿ä¸å¤Ÿä¸€æ‰¹ä¹Ÿå‘ï¼‰</span></span>
<span class="line">  <span class="token key atrule">worker</span><span class="token punctuation">:</span> <span class="token number">2</span></span>
<span class="line">  <span class="token key atrule">loadbalance</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä¼˜åŒ–æ€§èƒ½</span></span>
<span class="line"><span class="token key atrule">queue.mem</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">events</span><span class="token punctuation">:</span> <span class="token number">4096</span></span>
<span class="line">  <span class="token key atrule">flush.min_events</span><span class="token punctuation">:</span> <span class="token number">512</span></span>
<span class="line">  <span class="token key atrule">flush.timeout</span><span class="token punctuation">:</span> <span class="token string">&quot;5s&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âœ… æ•ˆæœï¼š<strong>å¤šæ¡æ—¥å¿—æ‰“åŒ… + å‹ç¼©åä¸€æ¬¡æ€§å‘é€ï¼Œç½‘ç»œæ•ˆç‡æå‡ 5~10 å€</strong></p></blockquote><hr><h3 id="âœ…-æ–¹æ¡ˆ-2-java-åº”ç”¨-â†’-kafka-â†’-logstash-é«˜åååœºæ™¯" tabindex="-1"><a class="header-anchor" href="#âœ…-æ–¹æ¡ˆ-2-java-åº”ç”¨-â†’-kafka-â†’-logstash-é«˜åååœºæ™¯"><span>âœ… æ–¹æ¡ˆ 2ï¼šJava åº”ç”¨ â†’ <strong>Kafka â†’ Logstash</strong>ï¼ˆé«˜åååœºæ™¯ï¼‰</span></a></h3><p>æ¶æ„ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Java App â†’ Kafkaï¼ˆæ‰¹é‡+å‹ç¼©ï¼‰ â†’ Logstash â†’ ES</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="ä¼˜ç‚¹" tabindex="-1"><a class="header-anchor" href="#ä¼˜ç‚¹"><span>ä¼˜ç‚¹ï¼š</span></a></h4><ul><li>Kafka å¤©ç„¶æ”¯æŒ <strong>æ‰¹é‡å‘é€ã€gzip/snappy å‹ç¼©ã€é«˜ååã€å‰Šå³°å¡«è°·</strong></li><li>è§£è€¦æ—¥å¿—ç”Ÿäº§ä¸æ¶ˆè´¹</li><li>æ”¯æŒé‡æ”¾ã€å¤šæ¶ˆè´¹è€…</li></ul><h4 id="java-é…ç½®-logback-kafka-appender" tabindex="-1"><a class="header-anchor" href="#java-é…ç½®-logback-kafka-appender"><span>Java é…ç½®ï¼ˆLogback + Kafka Appenderï¼‰ï¼š</span></a></h4><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>KAFKA<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.github.danielwegener.logback.kafka.KafkaAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>topic</span><span class="token punctuation">&gt;</span></span>logs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>topic</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keyingStrategy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...IntegerKeyingStrategy<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>deliveryStrategy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...AsynchronousDeliveryStrategy<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>producerConfig</span><span class="token punctuation">&gt;</span></span>bootstrap.servers=kafka:9092<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>producerConfig</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>producerConfig</span><span class="token punctuation">&gt;</span></span>compression.type=gzip<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>producerConfig</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>producerConfig</span><span class="token punctuation">&gt;</span></span>batch.size=16384<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>producerConfig</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>producerConfig</span><span class="token punctuation">&gt;</span></span>linger.ms=20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>producerConfig</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>net.logstash.logback.encoder.LogstashEncoder<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âœ… é€‚åˆæ—¥å¿—é‡å¤§ï¼ˆ&gt;1000æ¡/ç§’ï¼‰çš„ç³»ç»Ÿ</p></blockquote><hr><h3 id="âœ…-æ–¹æ¡ˆ-3-java-ç›´è¿-logstash-â†’-å¯ç”¨-æ‰¹é‡-å‹ç¼©-æœ‰é™æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#âœ…-æ–¹æ¡ˆ-3-java-ç›´è¿-logstash-â†’-å¯ç”¨-æ‰¹é‡-å‹ç¼©-æœ‰é™æ”¯æŒ"><span>âœ… æ–¹æ¡ˆ 3ï¼šJava ç›´è¿ Logstash â†’ å¯ç”¨ <strong>æ‰¹é‡ + å‹ç¼©</strong>ï¼ˆæœ‰é™æ”¯æŒï¼‰</span></a></h3><p><code>logstash-logback-encoder</code> æœ¬èº« <strong>ä¸æ”¯æŒæ‰¹é‡å‘é€</strong>ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼˜åŒ–ï¼š</p><h4 id="æ–¹å¼-a-ä½¿ç”¨-loggingeventcompositejsonencoder-å¼‚æ­¥-appender" tabindex="-1"><a class="header-anchor" href="#æ–¹å¼-a-ä½¿ç”¨-loggingeventcompositejsonencoder-å¼‚æ­¥-appender"><span>æ–¹å¼ Aï¼šä½¿ç”¨ <code>LoggingEventCompositeJsonEncoder</code> + å¼‚æ­¥ Appender</span></a></h4><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LOGSTASH<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>net.logstash.logback.appender.LogstashTcpSocketAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>destination</span><span class="token punctuation">&gt;</span></span>host.docker.internal:5000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>destination</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">&lt;!-- ä½¿ç”¨å¼‚æ­¥å‘é€ï¼Œå‡å°‘é˜»å¡ --&gt;</span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>eventDeliveryStrategy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>net.logstash.logback.async.AwaitingEventDeliveryStrategy<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">  </span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>providers</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timestamp</span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logLevel</span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>message</span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>loggerName</span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mdc</span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stackTrace</span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>providers</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">&lt;!-- åŒ…è£¹æˆå¼‚æ­¥ --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ASYNC<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.classic.AsyncAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LOGSTASH<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queueSize</span><span class="token punctuation">&gt;</span></span>2048<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>queueSize</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discardingThreshold</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discardingThreshold</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includeCallerData</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includeCallerData</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âš ï¸ ä»ç„¶æ˜¯ä¸€æ¡æ¡å‘ï¼Œä½† <strong>å¼‚æ­¥å‘é€ä¸é˜»å¡ä¸šåŠ¡çº¿ç¨‹</strong></p></blockquote><hr><h3 id="âœ…-æ–¹æ¡ˆ-4-è‡ªå·±å®ç°-æ”’æ‰¹å‘é€-ä¸æ¨è-å¤æ‚" tabindex="-1"><a class="header-anchor" href="#âœ…-æ–¹æ¡ˆ-4-è‡ªå·±å®ç°-æ”’æ‰¹å‘é€-ä¸æ¨è-å¤æ‚"><span>âœ… æ–¹æ¡ˆ 4ï¼šè‡ªå·±å®ç°â€œæ”’æ‰¹å‘é€â€ï¼ˆä¸æ¨èï¼Œå¤æ‚ï¼‰</span></a></h3><p>ä¸æ¨èæ‰‹åŠ¨å®ç°â€œæ”’ 100 æ¡å†å‘â€ï¼Œå› ä¸ºï¼š</p><ul><li>å®¹æ˜“ä¸¢æ—¥å¿—ï¼ˆåº”ç”¨å´©æºƒï¼‰</li><li>å¢åŠ å»¶è¿Ÿ</li><li>å¤±å»å®æ—¶æ€§</li><li>å¢åŠ ä»£ç å¤æ‚åº¦</li></ul><p>ä¸å¦‚ç›´æ¥ç”¨ <strong>Filebeat æˆ– Kafka</strong></p><hr><h2 id="âœ…-å¦‚ä½•éªŒè¯æ˜¯å¦-å‹ç¼©-æ‰¹é‡-æˆåŠŸ" tabindex="-1"><a class="header-anchor" href="#âœ…-å¦‚ä½•éªŒè¯æ˜¯å¦-å‹ç¼©-æ‰¹é‡-æˆåŠŸ"><span>âœ… å¦‚ä½•éªŒè¯æ˜¯å¦â€œå‹ç¼©+æ‰¹é‡â€æˆåŠŸï¼Ÿ</span></a></h2><h3 id="_1-æŸ¥çœ‹ç½‘ç»œæµé‡" tabindex="-1"><a class="header-anchor" href="#_1-æŸ¥çœ‹ç½‘ç»œæµé‡"><span>1. æŸ¥çœ‹ç½‘ç»œæµé‡</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> stats</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¯¹æ¯”å¼€å¯å‹ç¼©å‰åï¼Œ<code>logstash</code> å’Œ <code>filebeat</code> çš„ç½‘ç»œ IOã€‚</p><h3 id="_2-æŸ¥çœ‹-logstash-æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_2-æŸ¥çœ‹-logstash-æ—¥å¿—"><span>2. æŸ¥çœ‹ Logstash æ—¥å¿—</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> logstash</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœçœ‹åˆ°ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Received 1024 events in batch</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¯´æ˜æ˜¯æ‰¹é‡æ¥æ”¶ï¼ˆFilebeat/Kafka æ¨¡å¼æ‰æœ‰ï¼‰ã€‚</p><h3 id="_3-æŠ“åŒ…åˆ†æ-é«˜çº§" tabindex="-1"><a class="header-anchor" href="#_3-æŠ“åŒ…åˆ†æ-é«˜çº§"><span>3. æŠ“åŒ…åˆ†æï¼ˆé«˜çº§ï¼‰</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">tcpdump <span class="token parameter variable">-i</span> any <span class="token parameter variable">-s</span> <span class="token number">0</span> <span class="token parameter variable">-w</span> logs.pcap port <span class="token number">5044</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç”¨ Wireshark æ‰“å¼€ï¼Œçœ‹æ¯ä¸ª TCP åŒ…æ˜¯å¦åŒ…å«å¤šæ¡æ—¥å¿—ã€‚</p><hr><h2 id="âœ…-æœ€ç»ˆæ¨èæ¶æ„-ç”Ÿäº§çº§" tabindex="-1"><a class="header-anchor" href="#âœ…-æœ€ç»ˆæ¨èæ¶æ„-ç”Ÿäº§çº§"><span>âœ… æœ€ç»ˆæ¨èæ¶æ„ï¼ˆç”Ÿäº§çº§ï¼‰</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>Java App<span class="token punctuation">]</span></span>
<span class="line">     â†“ <span class="token punctuation">(</span>å†™æ–‡ä»¶<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">[</span>app.log<span class="token punctuation">]</span></span>
<span class="line">     â†“</span>
<span class="line"><span class="token punctuation">[</span>Filebeat<span class="token punctuation">]</span> â†’ å‹ç¼© + æ‰¹é‡ + å¤šè¡Œåˆå¹¶</span>
<span class="line">     â†“ <span class="token punctuation">(</span><span class="token number">5044</span>, beats<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">[</span>Logstash<span class="token punctuation">]</span> â†’ è§£æ + è¿‡æ»¤</span>
<span class="line">     â†“</span>
<span class="line"><span class="token punctuation">[</span>Elasticsearch<span class="token punctuation">]</span></span>
<span class="line">     â†“</span>
<span class="line"><span class="token punctuation">[</span>Kibana<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŠ¿"><span>ä¼˜åŠ¿ï¼š</span></a></h3><table><thead><tr><th>ç‰¹æ€§</th><th>æ”¯æŒ</th></tr></thead><tbody><tr><td>âœ… æ‰¹é‡å‘é€</td><td>âœ”ï¸</td></tr><tr><td>âœ… Gzip å‹ç¼©</td><td>âœ”ï¸</td></tr><tr><td>âœ… å¤šè¡Œæ—¥å¿—</td><td>âœ”ï¸</td></tr><tr><td>âœ… æ–­ç‚¹ç»­ä¼ </td><td>âœ”ï¸</td></tr><tr><td>âœ… ä½å»¶è¿Ÿ</td><td>âœ”ï¸</td></tr><tr><td>âœ… é«˜åå</td><td>âœ”ï¸</td></tr></tbody></table><hr><h2 id="âœ…-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#âœ…-æ€»ç»“"><span>âœ… æ€»ç»“</span></a></h2><table><thead><tr><th>æ–¹æ¡ˆ</th><th>æ˜¯å¦å‹ç¼©</th><th>æ˜¯å¦æ‰¹é‡</th><th>æ¨èåº¦</th></tr></thead><tbody><tr><td>Filebeat + Logstash</td><td>âœ… gzip</td><td>âœ… æ‰¹é‡</td><td>â­â­â­â­â­</td></tr><tr><td>Kafka + Logstash</td><td>âœ… gzip/snappy</td><td>âœ… æ‰¹é‡</td><td>â­â­â­â­â˜†ï¼ˆé«˜ååï¼‰</td></tr><tr><td>Java ç›´è¿ Logstash</td><td>âŒ</td><td>âŒï¼ˆä¸€æ¡æ¡å‘ï¼‰</td><td>â­â­â˜†</td></tr><tr><td>è‡ªå·±æ”’æ‰¹</td><td>âŒ/âœ…ï¼ˆå¤æ‚ï¼‰</td><td>âœ…</td><td>â­ï¼ˆä¸æ¨èï¼‰</td></tr></tbody></table><hr><p>ğŸ”§ <strong>ç«‹å³è¡ŒåŠ¨å»ºè®®</strong>ï¼š</p><ol><li>åœæ‰ Java ç›´è¿ Logstash</li><li>æ”¹ä¸ºï¼šJava å†™æ–‡ä»¶ â†’ Filebeat é‡‡é›† â†’ Logstash</li><li>åœ¨ <code>filebeat.yml</code> ä¸­å¯ç”¨ <code>compression_level: 6</code> å’Œ <code>bulk_max_size: 2048</code></li></ol><p>æ‚¨ä¼šç«‹åˆ»çœ‹åˆ° <strong>ç½‘ç»œæµé‡ä¸‹é™ 60%~80%</strong>ï¼Œç³»ç»Ÿæ›´ç¨³å®šã€‚</p>`,137)]))}const o=n(l,[["render",p],["__file","wanzhengelkjiaoben.html.vue"]]),u=JSON.parse('{"path":"/blogs/gongzuo/elk/wanzhengelkjiaoben.html","title":"å®Œæ•´elkè„šæœ¬","lang":"en-US","frontmatter":{"title":"å®Œæ•´elkè„šæœ¬","date":"2025/08/31","tags":["elk"],"categories":["elk"]},"headers":[{"level":2,"title":"âœ… ç›®æ ‡","slug":"âœ…-ç›®æ ‡","link":"#âœ…-ç›®æ ‡","children":[]},{"level":2,"title":"âœ… æ•´ä½“æ¶æ„","slug":"âœ…-æ•´ä½“æ¶æ„","link":"#âœ…-æ•´ä½“æ¶æ„","children":[]},{"level":2,"title":"âœ… æ­¥éª¤ 1ï¼šå‡†å¤‡ docker-compose.yml","slug":"âœ…-æ­¥éª¤-1-å‡†å¤‡-docker-compose-yml","link":"#âœ…-æ­¥éª¤-1-å‡†å¤‡-docker-compose-yml","children":[]},{"level":2,"title":"âœ… æ­¥éª¤ 2ï¼šåˆ›å»º logstash.conf","slug":"âœ…-æ­¥éª¤-2-åˆ›å»º-logstash-conf","link":"#âœ…-æ­¥éª¤-2-åˆ›å»º-logstash-conf","children":[]},{"level":2,"title":"âœ… æ­¥éª¤ 3ï¼šå¯åŠ¨ ELK æ ˆ","slug":"âœ…-æ­¥éª¤-3-å¯åŠ¨-elk-æ ˆ","link":"#âœ…-æ­¥éª¤-3-å¯åŠ¨-elk-æ ˆ","children":[]},{"level":2,"title":"âœ… æ­¥éª¤ 4ï¼šå‘é€æ—¥å¿—åˆ° Logstash","slug":"âœ…-æ­¥éª¤-4-å‘é€æ—¥å¿—åˆ°-logstash","link":"#âœ…-æ­¥éª¤-4-å‘é€æ—¥å¿—åˆ°-logstash","children":[{"level":3,"title":"âœ… æ–¹å¼ Aï¼šä½¿ç”¨ Filebeatï¼ˆæ¨èï¼‰","slug":"âœ…-æ–¹å¼-a-ä½¿ç”¨-filebeat-æ¨è","link":"#âœ…-æ–¹å¼-a-ä½¿ç”¨-filebeat-æ¨è","children":[]},{"level":3,"title":"âœ… æ–¹å¼ Bï¼šJava åº”ç”¨ç›´æ¥å‘ TCPï¼ˆç»“æ„åŒ– JSONï¼‰","slug":"âœ…-æ–¹å¼-b-java-åº”ç”¨ç›´æ¥å‘-tcp-ç»“æ„åŒ–-json","link":"#âœ…-æ–¹å¼-b-java-åº”ç”¨ç›´æ¥å‘-tcp-ç»“æ„åŒ–-json","children":[]}]},{"level":2,"title":"âœ… æ­¥éª¤ 5ï¼šåœ¨ Kibana æŸ¥çœ‹æ—¥å¿—","slug":"âœ…-æ­¥éª¤-5-åœ¨-kibana-æŸ¥çœ‹æ—¥å¿—","link":"#âœ…-æ­¥éª¤-5-åœ¨-kibana-æŸ¥çœ‹æ—¥å¿—","children":[]},{"level":2,"title":"âœ… éªŒè¯ Logstash æ˜¯å¦æ”¶åˆ°æ—¥å¿—","slug":"âœ…-éªŒè¯-logstash-æ˜¯å¦æ”¶åˆ°æ—¥å¿—","link":"#âœ…-éªŒè¯-logstash-æ˜¯å¦æ”¶åˆ°æ—¥å¿—","children":[]},{"level":2,"title":"âœ… å¸¸è§é—®é¢˜æ’æŸ¥","slug":"âœ…-å¸¸è§é—®é¢˜æ’æŸ¥","link":"#âœ…-å¸¸è§é—®é¢˜æ’æŸ¥","children":[{"level":3,"title":"è§£å†³æ–¹æ¡ˆ","slug":"è§£å†³æ–¹æ¡ˆ","link":"#è§£å†³æ–¹æ¡ˆ","children":[]}]},{"level":2,"title":"âœ… ç›®æ ‡ï¼šå‹ç¼©æ—¥å¿—ä¼ è¾“","slug":"âœ…-ç›®æ ‡-å‹ç¼©æ—¥å¿—ä¼ è¾“","link":"#âœ…-ç›®æ ‡-å‹ç¼©æ—¥å¿—ä¼ è¾“","children":[]},{"level":2,"title":"ğŸš€ æ¨èæ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰","slug":"ğŸš€-æ¨èæ–¹æ¡ˆ-æŒ‰ä¼˜å…ˆçº§æ’åº","link":"#ğŸš€-æ¨èæ–¹æ¡ˆ-æŒ‰ä¼˜å…ˆçº§æ’åº","children":[{"level":3,"title":"âœ… æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ Filebeat + Bulk æ‰¹é‡å‘é€ï¼ˆæœ€æ¨èï¼ç”Ÿäº§é¦–é€‰ï¼‰","slug":"âœ…-æ–¹æ¡ˆ-1-ä½¿ç”¨-filebeat-bulk-æ‰¹é‡å‘é€-æœ€æ¨è-ç”Ÿäº§é¦–é€‰","link":"#âœ…-æ–¹æ¡ˆ-1-ä½¿ç”¨-filebeat-bulk-æ‰¹é‡å‘é€-æœ€æ¨è-ç”Ÿäº§é¦–é€‰","children":[]},{"level":3,"title":"âœ… æ–¹æ¡ˆ 2ï¼šJava åº”ç”¨ â†’ Kafka â†’ Logstashï¼ˆé«˜åååœºæ™¯ï¼‰","slug":"âœ…-æ–¹æ¡ˆ-2-java-åº”ç”¨-â†’-kafka-â†’-logstash-é«˜åååœºæ™¯","link":"#âœ…-æ–¹æ¡ˆ-2-java-åº”ç”¨-â†’-kafka-â†’-logstash-é«˜åååœºæ™¯","children":[]},{"level":3,"title":"âœ… æ–¹æ¡ˆ 3ï¼šJava ç›´è¿ Logstash â†’ å¯ç”¨ æ‰¹é‡ + å‹ç¼©ï¼ˆæœ‰é™æ”¯æŒï¼‰","slug":"âœ…-æ–¹æ¡ˆ-3-java-ç›´è¿-logstash-â†’-å¯ç”¨-æ‰¹é‡-å‹ç¼©-æœ‰é™æ”¯æŒ","link":"#âœ…-æ–¹æ¡ˆ-3-java-ç›´è¿-logstash-â†’-å¯ç”¨-æ‰¹é‡-å‹ç¼©-æœ‰é™æ”¯æŒ","children":[]},{"level":3,"title":"âœ… æ–¹æ¡ˆ 4ï¼šè‡ªå·±å®ç°â€œæ”’æ‰¹å‘é€â€ï¼ˆä¸æ¨èï¼Œå¤æ‚ï¼‰","slug":"âœ…-æ–¹æ¡ˆ-4-è‡ªå·±å®ç°-æ”’æ‰¹å‘é€-ä¸æ¨è-å¤æ‚","link":"#âœ…-æ–¹æ¡ˆ-4-è‡ªå·±å®ç°-æ”’æ‰¹å‘é€-ä¸æ¨è-å¤æ‚","children":[]}]},{"level":2,"title":"âœ… å¦‚ä½•éªŒè¯æ˜¯å¦â€œå‹ç¼©+æ‰¹é‡â€æˆåŠŸï¼Ÿ","slug":"âœ…-å¦‚ä½•éªŒè¯æ˜¯å¦-å‹ç¼©-æ‰¹é‡-æˆåŠŸ","link":"#âœ…-å¦‚ä½•éªŒè¯æ˜¯å¦-å‹ç¼©-æ‰¹é‡-æˆåŠŸ","children":[{"level":3,"title":"1. æŸ¥çœ‹ç½‘ç»œæµé‡","slug":"_1-æŸ¥çœ‹ç½‘ç»œæµé‡","link":"#_1-æŸ¥çœ‹ç½‘ç»œæµé‡","children":[]},{"level":3,"title":"2. æŸ¥çœ‹ Logstash æ—¥å¿—","slug":"_2-æŸ¥çœ‹-logstash-æ—¥å¿—","link":"#_2-æŸ¥çœ‹-logstash-æ—¥å¿—","children":[]},{"level":3,"title":"3. æŠ“åŒ…åˆ†æï¼ˆé«˜çº§ï¼‰","slug":"_3-æŠ“åŒ…åˆ†æ-é«˜çº§","link":"#_3-æŠ“åŒ…åˆ†æ-é«˜çº§","children":[]}]},{"level":2,"title":"âœ… æœ€ç»ˆæ¨èæ¶æ„ï¼ˆç”Ÿäº§çº§ï¼‰","slug":"âœ…-æœ€ç»ˆæ¨èæ¶æ„-ç”Ÿäº§çº§","link":"#âœ…-æœ€ç»ˆæ¨èæ¶æ„-ç”Ÿäº§çº§","children":[{"level":3,"title":"ä¼˜åŠ¿ï¼š","slug":"ä¼˜åŠ¿","link":"#ä¼˜åŠ¿","children":[]}]},{"level":2,"title":"âœ… æ€»ç»“","slug":"âœ…-æ€»ç»“","link":"#âœ…-æ€»ç»“","children":[]}],"git":{"createdTime":1755080218000,"updatedTime":1755082298000,"contributors":[{"name":"huangcheng","email":"2387020215@qq.com","commits":2}]},"filePathRelative":"blogs/å·¥ä½œ/elk/å®Œæ•´elkè„šæœ¬.md"}');export{o as comp,u as data};
